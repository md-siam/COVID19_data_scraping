function insertData(e,t,s,a,i,r,n){const o=Parse.Object.extend("COVID19"),c=new o;console.log("New data inserted at: "+t),c.set("upDate",e),c.set("upTime",t),c.set("labTest",s),c.set("confirmed",a),c.set("isolation",i),c.set("recovered",r),c.set("death",n),c.save().catch(function(e){console.log("Insert error: "+e.message),emailTrigger(!0)})}async function updateData(e,t,s,a,i,r,n){const o=Parse.Object.extend("COVID19"),c=new Parse.Query(o);c.equalTo("upDate",e);const l=await c.find();if(0==l)insertData(e,t,s,a,i,r,n);else{const e=await c.get(l[0].id);console.log("Old data updated at: "+t),e.set("upTime",t),e.set("labTest",s),e.set("confirmed",a),e.set("isolation",i),e.set("recovered",r),e.set("death",n),e.save().catch(function(e){console.log("Update error: "+e.message),emailTrigger(!0)})}}async function main(){await request("http://103.247.238.92/webportal/pages/covid19.php",(e,t,s)=>{if(e||200!=t.statusCode)console.log(e);else{const e=cheerio.load(s),t=e("html>body>div>div>section>div>div>div>span"),a=t.text().split(" "),i=a[0]+" "+a[1];if("Last updated:"==i){const t=a[2]+" "+a[3]+" "+a[4],s=a[5]+" "+a[6];e("html>body>div.wrapper>div>section>div:nth-child(3)>div.col-md-2.col-print-12>div>div.box-body").each((a,i)=>{const r=e(i).find("div"),n=e(r[0]).text().replace(/\n+/g,"").trim().split(" "),o=e(r[2]).text().replace(/\n+/g,"").trim().split(" "),c=e(r[4]).text().replace(/\n+/g,"").trim().split(" "),l=e(r[6]).text().replace(/\n+/g,"").trim().split(" "),d=e(r[8]).text().replace(/\n+/g,"").trim().split(" "),p=parseInt(n[0],10),g=parseInt(o[0],10),u=parseInt(c[0],10),m=parseInt(l[0],10),v=parseInt(d[0],10);updateData(t,s,p,g,u,m,v)})}else emailTrigger(!0)}})}const{emailTrigger:emailTrigger}=require("./emailtrigger.js"),Parse=require("parse/node"),request=require("request"),cheerio=require("cheerio");Parse.initialize(process.env.APP_ID,process.env.JS_KEY),Parse.serverURL=process.env.SERVER_URL,console.log("COVID19 data scraping has started..."),console.log("Running this task every 1 hour"),main();